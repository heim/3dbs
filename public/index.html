<!doctype html>
<html>
  <head>
    <title>3 Databases in approx. 33 minutes</title>
    <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <textarea id="source">
class: front-page

# 3 Databases in (approx.) 33 minutes

## En kjapp innføring i NoSQL

Date-IT, Chalmers 6/11 - 2013

Andreas Heim
BEKK Consulting
---
class: middle center
<iframe class="centered" width="560" height="315" src="//www.youtube.com/embed/FcLHlZeLzUk" frameborder="0" allowfullscreen></iframe>

---
# <span>Agenda</span>

## Databaseteori for distribuerte systemer
* ACID
* BASE
* CAP

## Praksis (yeah)
* Redis
* MongoDB
* Neo4J

---
class: middle center
# Not only SQL
???
- Begrepet ble først brukt av Carlo Strozzi i 1998.
- Han hadde en Open Source Relasjonsdatabase som ikke eksponerte et standard SQL-interface.
- Han har senere foreslått at det burde hete NoREL siden de fleste NoSQL-databaser går bort fra den relasjonelle modellen
- Begrepet ble reintrodusert i 2009 av Eric Evans for å forsøke å kategorisere en voksende mengde ikke-relasjonelle distribuerte
datastores.
---
class: middle center
<h1><span>Spørsmål: Hva er NoSQL?</span></h1>
---
class: white middle center
#Svar
## *.lightbrown[ALT SOM IKKE ER EN TRADISJONELL RELASJONSDATABASE]*
???
- Eller... La oss ta litt teori.
---
class: middle center
#ACID
???
- Atomicity
- Consistency
- Isolation
- Durability
---
class: middle 

.circle.centered.red[ATOMICITY]

???
- Atomicity er en av egenskapene ved transaksjoner.
- I en serie av databaseoperasjoner så må enten *alle* skje, eller *ingenting* skjer.
- En database som garanterer atomicity vil *motvirke* at en oppdatering til databasen kun vil gjennomføres delvis.
- Atomicity i denne forstanden kan defineres som at oppdateringen ikke kan verken deles eller forenkles.
---
class: middle 

.circle.centered.yellow[CONSISTENCY]

???
- I et databasesystem så vil *Consistency* sørge for at en transaksjon vil ta databasen fra èn gyldig tilstand, til en annen gyldig tilstand.
---
class: middle
.circle.centered.green[ISOLATION]
???
- Egenskapen *isolation* sørger for at alle transaksjoner skjer isolert og på samme måte som om de skulle vært kjørt i parallel.
- Eksempel: Et eller annet eksempel.
---
class: middle

.circle.centered.lightbrown[DURABILITY]

???

- Durability, eller holdbarhet på norsk sørger for at dataene blir tatt vare på selv om systemet kræsjer. Typisk in-memory databaser har lav durablity, imens clustrede installasjoner har høy durability.
- Sammenhenger også mye med hardware og operativsystem.
---
class: middle center

<h1><span>BASE</span></h1>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
</div>

<div class="col">
  &nbsp;
</div>

<div class="col">
  &nbsp;
</div>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
</div>

<div class="col">
  .circle.centered.red[S]
  # <span>Soft state</span>
</div>

<div class="col">
  &nbsp;
</div>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
</div>

<div class="col">
  .circle.centered.red[S]
  # <span>Soft state</span>
</div>

<div class="col">
  .circle.centered.yellow[E]
  # <span>Eventually consistent</span>
</div>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
  - garanterer tilgjengelighet (availability)
</div>

<div class="col">
  .circle.centered.red[S]
  # <span>Soft state</span>
</div>

<div class="col">
  .circle.centered.yellow[E]
  # <span>Eventually consistent</span>
</div>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
  - garanterer tilgjengelighet (availability)
</div>

<div class="col">
  .circle.centered.red[S]
  # <span>Soft state</span>
  - tilstand kan forandres over tid
  - til og med uten input til systemet
</div>

<div class="col">
  .circle.centered.yellow[E]
  # <span>Eventually consistent</span>
</div>
---
class: cols three
<h1><span>BASE</span></h1>

<div class="col">
  .circle.centered.green[BA]
  # <span>Basically Available</span>
  - garanterer tilgjengelighet (availability)
</div>

<div class="col">
  .circle.centered.red[S]
  # <span>Soft state</span>
  - tilstand kan forandres over tid
  - til og med uten input til systemet
</div>

<div class="col">
  .circle.centered.yellow[E]
  # <span>Eventually consistent</span>
  - systemet blir konsistent etter hvert
</div>
???
- Eksempel, skrive til en del av cluster, lese fra en annen
---
class: white middle center

# CAP THEOREM

???
- Consistency (ACID)
- Availability (redundans)
- Partition tolerance (skalering)

---
class: white middle

.circle.centered.red[CONSISTENCY]
???
- Alle noder ser de samme dataene hele tiden.
- Hvis man skriver til en node og leser fra en annen rett etterpå, er dataene konsistente med en gang?
- Eventual consistency er noe man snakker mye om i NoSQL-sammenheng. Dataene vil bli spredt til alle noder "etterhvert".
---
class: white middle
.circle.centered.green[AVAILABILITY]
???
- Hva skjer hvis en node i clusteret går ned? Kan man fortsatt lese fra clusteret?
---
class: cols three middle
<div class="col">
  .circle.lightbrown.centered[PARTITION]
</div>
<div class="col">
  &nbsp;
</div>
<div class="col">
  .circle.yellow.centered[TOLERANCE]
</div>
???
- Hva skjer når to noder i clusteret ikke kan snakke sammen lenger?
- (Nettverksbrudd)
---
class: cols three
<h1><span>Velg to</span></h1>
<div class="col">
.circle.green.centered[CP]
<h1><span>Enforced consistency</span></h1>
</div>
<div class="col">
  &nbsp;
</div>
<div class="col">
  &nbsp;
</div>
---
class: cols three
<h1><span>Velg to</span></h1>

<div class="col">
  .circle.green.centered[CP]
  <h1><span>Enforced consistency</span></h1>

  - alltid konsistent
  - ACID-databaser *må* velge dette.
</div>
<div class="col">
  &nbsp;
</div>
<div class="col">
  &nbsp;
</div>
---
class: cols three

<h1><span>Velg to</span></h1>

<div class="col">
  .circle.green.centered[CP]
  <h1><span>Enforced consistency</span></h1>

  - alltid konsistent
  - ACID-databaser *må* velge dette.
</div>

<div class="col">
  .circle.red.centered[AP]
  <h1><span>Eventual consistency</span></h1>
</div>

<div class="col">
  &nbsp;
</div>
---
class: cols three

<h1><span>Velg to</span></h1>

<div class="col">
  .circle.green.centered[CP]
  <h1><span>Enforced consistency</span></h1>

  - alltid konsistent
  - ACID-databaser *må* velge dette.
</div>

<div class="col">
  .circle.red.centered[AP]
  <h1><span>Eventual consistency</span></h1>

  - tilgjengelig over konsistent
  - typisk for BASE
</div>

<div class="col">
  &nbsp;
</div>
---
class: cols three

<h1><span>Velg to</span></h1>

<div class="col">
  .circle.green.centered[CP]
  <h1><span>Enforced consistency</span></h1>

  - alltid konsistent
  - ACID-databaser *må* velge dette.
</div>

<div class="col">
  .circle.red.centered[AP]
  <h1><span>Eventual consistency</span></h1>

  - tilgjengelig over konsistent
  - typisk for BASE
</div>

<div class="col">
  .circle.yellow.centered[CA]
  <h1><span>Consistently available</span></h1>
</div>
---
class: cols three

<h1><span>Velg to</span></h1>

<div class="col">
  .circle.green.centered[CP]
  <h1><span>Enforced consistency</span></h1>

  - alltid konsistent
  - ACID-databaser *må* velge dette.
</div>

<div class="col">
  .circle.red.centered[AP]
  <h1><span>Eventual consistency</span></h1>

  - tilgjengelig over konsistent
  - typisk for BASE
</div>

<div class="col">
  .circle.yellow.centered[CA]
  <h1><span>Consistently available</span></h1>

  - alltid tilgjengelig?
  - alltid konsistent?
</div>
---
class: round
<span class="img">
![](img/think.png)
</span>
???

Hvis vi har et distribuert system:
- klienter skriver til forskjellige deler av clusteret
- clusteret blir partisjonert pga en nettverksfeil
- klientene fortsetter å skrive til hver sin del
- hvordan sammenstiller man data??
- git merge?
- hva med konflikter?
---

class: cols two

# <span>Velg èn</span>

<div class="col">
  .circle.red.centered[CONSISTENCY]
  # <span>Mer konsistent</span>
</div>

<div class="col">
  .circle.green.centered[AVAILABILITY]
  # <span>Mer tilgjengelig</span>
</div>
???

- Vi må velge enten mer konsistens eller mer tilgjengelighet
- Det går ikke å ha maksimalt med tilgjengelighet eller konistens!
---
class: cols two

# <span>Velg èn</span>

<div class="col">
  .circle.red.centered[CONSISTENCY]
  # <span>Mer konsistent</span>

  - Transaksjon ikke godkjent før alle noder har mottatt data
  - Alle noder får samme data
</div>

<div class="col">
  .circle.green.centered[AVAILABILITY]
  # <span>Mer tilgjengelig</span>
</div>

---
class: cols two

# <span>Velg èn</span>

<div class="col">
  .circle.red.centered[CONSISTENCY]
  # <span>Mer konsistent</span>

  - Transaksjon ikke godkjent før alle noder har mottatt data
  - Alle noder får samme data
</div>

<div class="col">
  .circle.green.centered[AVAILABILITY]
  # <span>Mer tilgjengelig</span>

  - Synkronisering mellom noder
  - To klienter kan få forskjellige data samtidig
</div>
???

- 100% konsistente data krever total stopp ved nettverksbrudd
- 100% oppetid (availability) fører med seg inkonsistens!
- Men, det finnes grader av begge egenskaper.
- F.eks. hvor kommer latency inn, hvor lenge er systemene partisjonert?

---
class: pushed
<span class="img">
![](img/hands.png)
</span>

---
class: cols three
<h1><span>Praksis</span></h1>

<div class="cols three">
  <div class="col">
  .circle.green.centered[MongoDB]
  </div>
--
  <div class="col">
  .circle.yellow.centered[Redis]
  </div>
--
  <div class="col">
  .circle.lightbrown.centered[neo4j]
  </div>
</div>
--
<div class="cols three">
  <div class="col">
  # <span>Dokumentdatabase</span>
  </div>
--
  <div class="col">
  # <span> Key-value +++</span>
  </div>
--
  <div class="col">
  # <span>Grafdatabase</span>
  </div>
</div>
???


# Mongo

* ingen relasjoner
* embedded documents
* skalerer meget godt horisontalt
* ikke ACID p.g.a. ingen transaksjoner på tvers av dokumenter
* eventually consistent 
* write concerns
* Strong consistency ved single-master-system
* Reading from secondaries -> relaxed consistency

# Neo

* ACID
* optimalisert for sammenkoblede data
* eks. hvem følger hvem på twitter
* Consistent, Available, men *ikke* distribuert

---
name: Redis
class: round

![](img/redis.png)

???

# Redis

* limet i webapplikasjonen
* data structure server
  * løser veldig mange normale problemer
  * køer
  * expiry
  * caching
  * ranking
  * telling
* in-memory så ikke durable
* relaxed consistency ved distribuerte installasjoner
* har et veldig lav-nivå api
* mange forskjellige kommandoer som gjør èn ting og den tingen gjør de bra


---
name: redis-term
class: cols white
# <span>Redis</span>


<div id="redis-term"></div>

<div style="clear: both"></div>



<ul id="redis-list"></ul>

<p>
  <a href="#" id="resume">Resume</a>
  <a href="#" class="redis-cmd" data-command="foo">ls</a>
</p>


---
class: center pushed


![ux](img/ux.png)

### *.lightbrown[CAFE BULTEN]*
## I KVELD KL. 17.00
### *.lightbrown[uxcup.bekk.no]*

???

UX Cup er en interaksjonsdesign konkurranse for 3.-5. klassinger som vi arrangerer for 7 skoler i 3 byer. Vinnerlaget blir med BEKK til Lisboa på UXLx konferansen. Chalmers har vunnet de siste 2 årene, klarer de å forsvare seieren?

---
class: pushed
<span class="img">
![](img/resepsjon.png)
</span>


<h1><span>Sommerjobb i BEKK</span></h1>

.circle.yellow.top-right[Søknadsfrist 8. november]

##Send søknad med CV og karakterer (betyg) til jobb@bekk.no.

*.lightbrown[P.S. Vi skjønner svensk]*
</textarea>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/term.js"></script>
    <script src="http://gnab.github.io/remark/downloads/remark-0.5.9.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script> 
    
    <link rel="stylesheet/less" type="text/css" href="lib/bekk.less" />
    <script src="lib/less.js" type="text/javascript"></script>
    <script src="lib/pres.js" type="text/javascript"></script>
  </body>
</html>
